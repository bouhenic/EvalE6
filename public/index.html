<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>√âvaluation BTS CIEL - √âpreuve E6</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <header>
    <div class="container" style="text-align: center;">
      <h1 style="font-size: 2.5rem; margin-bottom: 0.5rem;">√âvaluation BTS CIEL</h1>
      <p style="font-size: 1.25rem;">√âpreuve E6 : Valorisation de la donn√©e et cybers√©curit√©</p>
      <p id="jury-info" style="position: absolute; top: 1rem; left: 1rem; font-weight: 600; display: none; font-size: 0.875rem; opacity: 0.9; color: white;"></p>
    </div>
  </header>

  <div class="container">
    <div id="message-container"></div>

    <!-- Champs cach√©s pour stocker les valeurs de configuration -->
    <input type="hidden" id="etablissement">
    <input type="hidden" id="academie">
    <input type="hidden" id="session">

    <div class="card">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
        <h2 style="margin: 0;">Liste des √©l√®ves</h2>
        <div style="display: flex; gap: 0.5rem; align-items: center;">
          <div class="action-menu">
            <button id="btn-admin-menu" class="btn btn-secondary">
              ‚öôÔ∏è Gestion ‚ñº
            </button>
            <div class="action-dropdown" id="admin-dropdown">
              <button class="action-item" id="btn-manage-users">
                üë§ G√©rer les utilisateurs
              </button>
              <button class="action-item" id="btn-manage-jury">
                üë• G√©rer les jurys
              </button>
              <button class="action-item" id="btn-manage-projets">
                üìÅ Gestion des projets
              </button>
              <div class="action-divider"></div>
              <button class="action-item" id="btn-print-recap">
                üñ®Ô∏è Imprimer tableau r√©capitulatif
              </button>
              <button class="action-item" id="btn-manage-config">
                ‚öôÔ∏è Configuration √©tablissement
              </button>
              <button class="action-item" id="btn-change-password">
                üîí Changer mon mot de passe
              </button>
              <button class="action-item" id="btn-manage-lock" style="display: none;">
                üîê G√©rer le verrouillage admin
              </button>
            </div>
          </div>
          <button id="btn-add-eleve" class="btn btn-primary">+ Ajouter un √©l√®ve</button>
        </div>
      </div>

      <table id="eleves-table">
        <thead>
          <tr>
            <th>N¬∞</th>
            <th>Nom</th>
            <th>Pr√©nom</th>
            <th class="filter-header">
              <span class="filter-label">Projet</span>
              <select id="filter-projet" class="table-filter-hover">
                <option value="">Tous</option>
              </select>
            </th>
            <th class="filter-header">
              <span class="filter-label">Jury</span>
              <select id="filter-jury" class="table-filter-hover">
                <option value="">Tous</option>
                <option value="jury1">Jury 1</option>
                <option value="jury2">Jury 2</option>
                <option value="unassigned">Non assign√©</option>
              </select>
            </th>
            <th>Statut</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="eleves-tbody">
          <tr>
            <td colspan="7" class="text-center">Chargement...</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Modal pour ajouter un √©l√®ve -->
  <div id="modal-add-eleve" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Ajouter un nouvel √©l√®ve</h3>
        <button class="btn-close" id="btn-close-modal">&times;</button>
      </div>
      <div class="modal-body">
        <form id="form-add-eleve">
          <div class="form-group">
            <label for="new-nom">Nom *</label>
            <input type="text" id="new-nom" required placeholder="Nom de l'√©l√®ve">
          </div>
          <div class="form-group">
            <label for="new-prenom">Pr√©nom *</label>
            <input type="text" id="new-prenom" required placeholder="Pr√©nom de l'√©l√®ve">
          </div>
          <div class="form-group">
            <label for="new-promotion">Promotion *</label>
            <input type="text" id="new-promotion" required placeholder="Ex: BTS CIEL IR 2025">
          </div>
          <div class="form-group">
            <label for="new-numero">Num√©ro candidat *</label>
            <input type="text" id="new-numero" required placeholder="Num√©ro du candidat">
          </div>
          <div class="form-group">
            <label for="new-jury">Jury</label>
            <select id="new-jury">
              <option value="">-- Non assign√© --</option>
              <option value="jury1">Jury 1</option>
              <option value="jury2">Jury 2</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="btn-cancel-modal">Annuler</button>
        <button class="btn btn-primary" id="btn-submit-eleve">Ajouter</button>
      </div>
    </div>
  </div>

  <!-- Modal pour g√©rer les jurys -->
  <div id="modal-manage-jury" class="modal hidden">
    <div class="modal-content" style="max-width: 800px;">
      <div class="modal-header">
        <h3>Gestion des membres des jurys</h3>
        <button class="btn-close" id="btn-close-jury-modal">&times;</button>
      </div>
      <div class="modal-body">
        <!-- Jury 1 -->
        <div class="jury-section">
          <h4 style="color: #667eea; margin-bottom: 1rem;">Jury 1</h4>
          <div id="jury1-members"></div>
          <button class="btn btn-secondary btn-sm" id="btn-add-jury1-member" style="margin-top: 0.5rem;">+ Ajouter un membre</button>
        </div>

        <hr style="margin: 2rem 0; border: none; border-top: 1px solid #e2e8f0;">

        <!-- Jury 2 -->
        <div class="jury-section">
          <h4 style="color: #667eea; margin-bottom: 1rem;">Jury 2</h4>
          <div id="jury2-members"></div>
          <button class="btn btn-secondary btn-sm" id="btn-add-jury2-member" style="margin-top: 0.5rem;">+ Ajouter un membre</button>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="btn-cancel-jury-modal">Annuler</button>
        <button class="btn btn-primary" id="btn-save-jury">Enregistrer</button>
      </div>
    </div>
  </div>

  <!-- Modal pour g√©rer les utilisateurs -->
  <div id="modal-manage-users" class="modal hidden">
    <div class="modal-content" style="max-width: 600px;">
      <div class="modal-header">
        <h3>Gestion des utilisateurs</h3>
        <button class="btn-close" id="btn-close-users-modal">&times;</button>
      </div>
      <div class="modal-body">
        <div id="users-list"></div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="btn-cancel-users-modal">Fermer</button>
      </div>
    </div>
  </div>

  <!-- Modal pour la configuration √©tablissement -->
  <div id="modal-manage-config" class="modal hidden">
    <div class="modal-content" style="max-width: 600px;">
      <div class="modal-header">
        <h3>‚öôÔ∏è Configuration √©tablissement</h3>
        <button class="btn-close" id="btn-close-config-modal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="modal-etablissement">√âtablissement *</label>
          <input type="text" id="modal-etablissement" placeholder="Nom de l'√©tablissement" required>
        </div>
        <div class="form-group">
          <label for="modal-academie">Acad√©mie *</label>
          <input type="text" id="modal-academie" placeholder="Nom de l'acad√©mie" required>
        </div>
        <div class="form-group">
          <label for="modal-session">Session (ann√©e) *</label>
          <input type="text" id="modal-session" placeholder="Ex: 2025" maxlength="4" pattern="[0-9]{4}" required>
        </div>
        <p style="color: #718096; font-size: 0.875rem; font-style: italic; margin-top: 1rem;">
          ‚ÑπÔ∏è Ces informations seront utilis√©es lors de la g√©n√©ration des fichiers Excel.
        </p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="btn-cancel-config-modal">Annuler</button>
        <button class="btn btn-primary" id="btn-save-config">Enregistrer</button>
      </div>
    </div>
  </div>

  <!-- Modal pour changer le mot de passe -->
  <div id="modal-change-password" class="modal hidden">
    <div class="modal-content" style="max-width: 500px;">
      <div class="modal-header">
        <h3>üîí Changer mon mot de passe</h3>
        <button class="btn-close" id="btn-close-password-modal">&times;</button>
      </div>
      <div class="modal-body">
        <form id="modal-change-password-form">
          <div class="form-group">
            <label for="modal-current-password">Mot de passe actuel *</label>
            <input type="password" id="modal-current-password" required autocomplete="current-password">
          </div>
          <div class="form-group">
            <label for="modal-new-password">Nouveau mot de passe *</label>
            <input type="password" id="modal-new-password" required minlength="6" autocomplete="new-password">
            <small style="color: #718096;">Minimum 6 caract√®res</small>
          </div>
          <div class="form-group">
            <label for="modal-confirm-password">Confirmer le nouveau mot de passe *</label>
            <input type="password" id="modal-confirm-password" required minlength="6" autocomplete="new-password">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="btn-cancel-password-modal">Annuler</button>
        <button class="btn btn-primary" id="btn-save-password">Modifier</button>
      </div>
    </div>
  </div>

  <!-- Modal pour la gestion des projets -->
  <div id="modal-manage-projets" class="modal hidden">
    <div class="modal-content" style="max-width: 900px;">
      <div class="modal-header">
        <h3>üìÅ Gestion des projets</h3>
        <button class="btn-close" id="btn-close-projets-modal">&times;</button>
      </div>
      <div class="modal-body">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
          <p style="margin: 0; color: #718096;">G√©rez la liste des projets pour les √©tudiants</p>
          <button id="btn-add-projet-modal" class="btn btn-primary">+ Ajouter un projet</button>
        </div>
        <div id="projets-list"></div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="btn-cancel-projets-modal">Fermer</button>
      </div>
    </div>
  </div>

  <!-- Modal pour la gestion du verrouillage (jury uniquement) -->
  <div id="modal-manage-lock" class="modal hidden">
    <div class="modal-content" style="max-width: 600px;">
      <div class="modal-header">
        <h3>üîê Gestion du verrouillage admin</h3>
        <button class="btn-close" id="btn-close-lock-modal">&times;</button>
      </div>
      <div class="modal-body">
        <p style="color: #718096; font-size: 0.875rem; margin-bottom: 1rem;">
          Pendant la p√©riode d'√©valuation, l'admin ne pourra pas acc√©der aux actions pour vos √©l√®ves (confidentialit√©).
        </p>

        <div id="lock-status-display" style="margin-bottom: 1.5rem;"></div>

        <div class="form-group">
          <label for="modal-lock-start">Date et heure de d√©but</label>
          <input type="datetime-local" id="modal-lock-start">
        </div>
        <div class="form-group">
          <label for="modal-lock-end">Date et heure de fin</label>
          <input type="datetime-local" id="modal-lock-end">
        </div>

        <div style="display: flex; gap: 0.5rem; margin-top: 1.5rem;">
          <button class="btn btn-primary" id="btn-set-lock" style="flex: 1;">Activer le verrouillage</button>
          <button class="btn btn-secondary" id="btn-unlock-admin" style="flex: 1;">D√©bloquer maintenant</button>
        </div>

        <p style="color: #718096; font-size: 0.875rem; font-style: italic; margin-top: 1.5rem;">
          ‚ÑπÔ∏è Vous pouvez d√©bloquer l'admin plus t√¥t si vos √©valuations se terminent avant la date pr√©vue.
        </p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="btn-cancel-lock-modal">Fermer</button>
      </div>
    </div>
  </div>

  <script src="/js/utils.js?v=24"></script>
  <script src="/js/csrf.js?v=24"></script>
  <script src="/js/auth-check.js?v=24"></script>
  <script src="/js/main.js?v=24"></script>
</body>
</html>
